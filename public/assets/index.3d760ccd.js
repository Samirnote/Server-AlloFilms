var T=Object.defineProperty,$=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var F=(t,n,r)=>n in t?T(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,b=(t,n)=>{for(var r in n||(n={}))O.call(n,r)&&F(t,r,n[r]);if(E)for(var r of E(n))D.call(n,r)&&F(t,r,n[r]);return t},y=(t,n)=>$(t,A(n));import{r as c,j as N,N as L,a as _,u as k,b as U,L as j,c as q,O as B,R as M,d as x,e as H,f as V,B as z}from"./vendor.88e4d24e.js";const Q=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}};Q();const P=c.exports.createContext(),w=()=>c.exports.useContext(P);const e=N.exports.jsx,d=N.exports.jsxs,f=N.exports.Fragment,K=()=>{const{isLoggedIn:t,currentUser:n,removeUser:r}=w();return d("nav",{className:"NavMain",children:[e(L,{className:"logo",to:"/",children:"AlloFilms"}),e(L,{to:"/films",children:"List"}),t&&d(f,{children:[e(L,{to:"/profile",children:n&&n.email}),e("button",{onClick:r,children:"Log-Out"})]}),!t&&d(f,{children:[e(L,{to:"/signin",children:"Log-in"}),e(L,{to:"/signup",children:"Sign-Up"})]})]})},C=_.create({baseURL:"http://allfilms.herokuapp.com",withCredentials:!0});C.interceptors.request.use(t=>{const n=localStorage.getItem("authToken");return t.headers.Authorization=n?`Bearer ${n}`:"",t});//! Error handling to use in the catch
function I(t){throw t.response.data&&console.log(t.response&&t.response.data),t}const m=y(b({},C),{signup(t){return C.post("/api/auth/signup",t).then(n=>n.data).catch(I)},isLoggedIn(t){return C.get("/api/auth/me",{headers:{Authorization:`Bearer ${t}`}}).then(n=>n.data).catch(I)},signin(t){return C.post("/api/auth/signin",t).then(n=>n.data).catch(I)}}),W=({setComments:t})=>{const{isLoggedIn:n}=w(),{id:r}=k(),[o,s]=c.exports.useState("");return U(),e(f,{children:n&&d("form",{onSubmit:l=>{l.preventDefault(),m.post(`/api/films/${r}/comments`,{content:o,film:r}).then(u=>{console.log(u),console.log("RESPONNNNSEEEE",u.data),t(i=>[...i,u.data])}).catch(u=>{console.log(u)})},children:[e("textarea",{type:"text",name:"content",onChange:l=>s(l.target.value)}),e("button",{children:"Submit your comment"})]})})},G=()=>e("div",{children:e("h1",{children:"Welcome \u{1F3E1}"})}),R=t=>{const[n,r]=c.exports.useState(t);return[n,s=>{r(y(b({},n),{[s.target.name]:s.target.value}))}]},J=()=>{const[{email:t,password:n},r]=R({email:"",password:""}),[o,s]=c.exports.useState(null),a=U(),{storeToken:l,authenticateUser:u}=w(),i=p=>{p.preventDefault(),m.signin({email:t,password:n}).then(S=>{console.log(S),l(S.authToken),u(),a("/")}).catch(S=>{s(S.response.data)})};return d(f,{children:[o&&e("h3",{className:"error",children:o.message}),d("form",{onSubmit:i,children:[e("h2",{children:"Signin"}),e("label",{htmlFor:"email",children:"Email"}),e("input",{type:"email",id:"email",name:"email",onChange:r,value:t}),e("label",{htmlFor:"password",children:"Password"}),e("input",{type:"password",id:"password",name:"password",onChange:r,value:n}),e("button",{children:"Submit"})]})]})},X=()=>e(J,{}),Y=()=>{const[t,n]=R({name:"",email:"",password:""}),[r,o]=c.exports.useState(null),s=U(),a=l=>{l.preventDefault(),m.signup(t).then(()=>{s("/signin")}).catch(u=>{o(u.response.data)})};return d(f,{children:[r&&e("h3",{className:"error",children:r.message}),d("form",{onSubmit:a,children:[e("h2",{children:"Signup"}),e("label",{htmlFor:"name",children:"Name"}),e("input",{onChange:n,value:t.name,type:"text",id:"name",name:"name"}),e("label",{htmlFor:"email",children:"Email"}),e("input",{onChange:n,value:t.email,type:"email",id:"email",name:"email"}),e("label",{htmlFor:"password",children:"Password"}),e("input",{onChange:n,value:t.password,type:"password",id:"password",name:"password"}),e("button",{children:"Submit"})]})]})},Z=()=>e(Y,{}),ee=()=>e("div",{children:e("p",{children:"This is a protected profile"})}),te=({searchCallback:t})=>d("form",{children:[e("label",{htmlFor:"search",children:"Search your movie"}),e("input",{type:"text",name:"search",onChange:n=>t(n.target.value)})]}),ne=()=>{const[t,n]=c.exports.useState([]),r=c.exports.useRef(0),o=c.exports.useRef(!1),[s,a]=c.exports.useState("");c.exports.useEffect(()=>{m.get("/api/films",{params:{q:s,offset:0}}).then(i=>n(i.data)).catch(i=>console.error(i))},[s]);const l=()=>{console.log(t.length),!(o.current||!t.length)&&(o.current=!0,r.current+=15,m.get("/api/films",{params:{q:s,offset:r.current}}).then(i=>{n(i.data),o.current=!1}).catch(i=>{console.error(i),o.current=!1}))},u=()=>{o.current||r.current<1||(o.current=!0,r.current-=15,m.get("/api/films",{params:{q:s,offset:r.current}}).then(i=>{n(i.data),o.current=!1}).catch(i=>{console.error(i),o.current=!1}))};return console.log("q:",s),console.log(t),d(f,{children:[e("h1",{children:"Our list of films"}),e(te,{searchCallback:a}),e("ul",{children:t.map((i,p)=>e(j,{to:`/films/${i._id}`,children:e("li",{children:i.name})},p))}),e("button",{onClick:u,children:"prev"}),"Page number: ",r.current/15,e("button",{onClick:l,children:"next"})]})},re=({comments:t,setComments:n})=>{const{isLoggedIn:r,currentUser:o}=w(),[s,a]=c.exports.useState(""),[l,u]=c.exports.useState({id:null,show:!1}),{id:i}=k(),p=(h,v)=>{m.patch(`/api/films/${i}/comments/${h}`,{content:s}).then(()=>{const g=[...t];g[v].content=s,n(g),u({id:null,show:!l.show})}).catch(g=>console.log(g))},S=h=>{m.delete(`/api/films/${i}/comments/${h}`).then(()=>{console.log("dans le then"),n(v=>v.filter(g=>g._id!==h)),u({id:null,show:!l.show})}).catch(v=>console.log(v))};return d(f,{children:[e("h2",{children:" Comments on this film"}),e("ul",{children:t.map((h,v)=>d("li",{children:[e("span",{children:h.author.name})," :",e("span",{children:h.content}),console.log("currentUser",o),console.log("author",h.author.name),r&&o.name===h.author.name&&e("button",{onClick:()=>u({id:h._id,show:!l.show}),children:"Edit"}),l.id===h._id&&l.show&&r&&o&&d(f,{children:[e("textarea",{name:"",id:"",cols:"30",rows:"10",defaultValue:h.content,onChange:g=>{a(g.target.value)}}),e("button",{onClick:()=>p(h._id,v),children:"Save edit"})]}),r&&o.name===h.author.name&&e("button",{onClick:()=>S(h._id),children:"Delete"})]},h._id))})]})},se=()=>{const[t,n]=c.exports.useState([]),{id:r}=k(),[o,s]=c.exports.useState([]);return c.exports.useEffect(()=>{m.get(`/api/films/${r}`).then(a=>{n(a.data)})},[t._id]),c.exports.useEffect(()=>{m.get(`/api/films/${r}/comments`).then(a=>s(a.data)).catch(a=>console.log(a))},[]),d("div",{className:"film-details",children:[d("h1",{children:[" Film : ",t.name]}),e("p",{children:t.description}),e("img",{src:t.picture,alt:t.name,width:"250px"}),e("div",{className:"trailer",children:console.log(t.videos)}),e(W,{setComments:s}),e(re,{comments:o,setComments:s})]})},oe=()=>{const{isLoggedIn:t,isLoading:n}=w();return n?e("p",{children:"Loading..."}):t?e(B,{}):e(q,{to:"/login"})};function ae(){return d("div",{className:"App",children:[e(K,{}),d(M,{children:[e(x,{path:"/",element:e(G,{})}),e(x,{path:"/films",element:e(ne,{})}),e(x,{path:"/films/:id",element:e(se,{})}),e(x,{path:"/signin",element:e(X,{})}),e(x,{path:"/signup",element:e(Z,{})}),e(x,{element:e(oe,{}),children:e(x,{path:"/profile",element:e(ee,{})})})]})]})}const ie=({children:t})=>{const[n,r]=c.exports.useState({currentUser:null,isLoading:!0,isLoggedIn:!1});c.exports.useEffect(()=>{o()},[]);const o=()=>{const i=localStorage.getItem("authToken");i?m.isLoggedIn(i).then(p=>{r({currentUser:p,isLoading:!1,isLoggedIn:!0})}).catch(p=>{r({currentUser:null,isLoading:!1,isLoggedIn:!1})}):r({currentUser:null,isLoading:!1,isLoggedIn:!1})},s=()=>{a(),o()},a=()=>{localStorage.removeItem("authToken")},l=i=>{localStorage.setItem("authToken",i)},u={currentUser:n.currentUser,isLoading:n.isLoading,isLoggedIn:n.isLoggedIn,removeUser:s,storeToken:l,authenticateUser:o};return e(P.Provider,{value:u,children:t})};H.render(e(V.StrictMode,{children:e(z,{children:e(ie,{children:e(ae,{})})})}),document.getElementById("root"));

var $=Object.defineProperty,D=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var R=(t,n,a)=>n in t?$(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,C=(t,n)=>{for(var a in n||(n={}))O.call(n,a)&&R(t,a,n[a]);if(A)for(var a of A(n))H.call(n,a)&&R(t,a,n[a]);return t},w=(t,n)=>D(t,_(n));import{r as d,j as y,N as k,L as N,a as j,u as F,b as I,F as q,c as B,d as M,O as V,R as z,e as b,f as Q,g as W,B as G}from"./vendor.f7c811ad.js";const K=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}};K();const E=d.exports.createContext(),S=()=>d.exports.useContext(E),e=y.exports.jsx,s=y.exports.jsxs,L=y.exports.Fragment,Y=()=>{const{isLoggedIn:t,currentUser:n,removeUser:a}=S();return s("nav",{id:"NavMain",className:"NavMain",children:[s("div",{children:[e(k,{className:"title Link",to:"/",children:"Homepage"}),e(k,{className:"Link",to:"/films",children:"Films"}),t&&s(L,{children:[e(k,{className:"Link",to:"/profile",children:"Profile"}),e("button",{id:"removeUser",className:"removeUser",onClick:a,children:"LogOut"})]})]}),!t&&s("div",{id:"logging",className:"logging",children:[e(N,{className:"Link",to:"/signin",children:"Sign-in"}),e(N,{className:"Link",to:"/signup",children:"Sign-Up"})]})]})};var P="/assets/logo.b5f867b1.png";function J(){return s("header",{id:"Header",className:"Header",children:[e("img",{className:"logo",src:P,alt:"logo image"}),e(Y,{})]})}function X(){return s("footer",{className:"footer",children:[e("img",{className:"logo",src:P,alt:"logo image"}),s("div",{id:"footerLinks",children:[e(N,{className:"Link",to:"/contact",children:"Contact Us"}),e(N,{className:"Link",to:"/legal",children:"Legal"}),e(N,{className:"Link",to:"/Legal",children:"Facebook"}),e(N,{className:"Link",to:"/Legal",children:"Twitter"}),e(N,{className:"Link",to:"/Legal",children:"Instagram"})]})]})}const x=j.create({baseURL:"https://allfilms.herokuapp.com",withCredentials:!0});x.interceptors.request.use(t=>{const n=localStorage.getItem("authToken");return t.headers.Authorization=n?`Bearer ${n}`:"",t});//! Error handling to use in the catch
function U(t){throw t.response.data&&console.log(t.response&&t.response.data),t}const u=w(C({},x),{signup(t){return x.post("/api/auth/signup",t).then(n=>n.data).catch(U)},isLoggedIn(t){return x.get("/api/auth/me",{headers:{Authorization:`Bearer ${t}`}}).then(n=>n.data).catch(U)},signin(t){return x.post("/api/auth/signin",t).then(n=>n.data).catch(U)}}),Z=({setComments:t})=>{const{isLoggedIn:n}=S(),{id:a}=F(),[i,r]=d.exports.useState("");return I(),e(L,{children:n&&s("form",{className:"formComment",onSubmit:c=>{c.preventDefault(),u.post(`/api/films/${a}/comments`,{content:i,film:a}).then(m=>{console.log(m),console.log("RESPONNNNSEEEE",m.data),t(o=>[...o,m.data])}).catch(m=>{console.log(m)})},children:[e("textarea",{type:"text",name:"content",onChange:c=>r(c.target.value)}),e("button",{children:"Submit your comment"})]})})};const ee=()=>{const[t,n]=d.exports.useState(0),[a,i]=d.exports.useState([]),r=a.length;d.exports.useEffect(async()=>{try{const{data:m}=await u.get("/api/films"),o=m.map(({picture:g})=>g);console.log("data for slides ? ",o),i(o)}catch(m){console.error(m)}},[]);const l=()=>{n(t===r-1?0:t+1)},c=()=>{n(t===0?r-1:t-1)};return!Array.isArray(a)||a.length<=0?null:s("section",{className:"slider",children:[e(q,{className:"left-arrow",onClick:c}),e(B,{className:"right-arrow",onClick:l}),a.map((m,o)=>e("div",{className:o===t?"slide active":"slide",children:o===t&&e("img",{src:m,alt:"travel image",className:"image-slider"})},o))]})};function te(){const[t,n]=d.exports.useState([]);return d.exports.useEffect(async()=>{try{const{data:a}=await u.get("/api/comments/lastComments");console.log("data for comments ",a),n(a)}catch(a){console.error(a)}},[]),!Array.isArray(t)||t.length<=0?e("p",{children:"Loading... "}):s("section",{className:"LastComments",children:[e("h2",{children:"Last comments on films:"}),e("div",{className:"last-commented-box",children:t.map(a=>s("div",{className:"comment-box",children:[e("div",{className:"image-author",children:e("img",{src:a.author.avatar,alt:"travel image",className:"image"})}),s("div",{className:"comment-infos",children:[e("div",{className:"comment-content",children:a.content}),e("div",{className:"comment-date",children:a.date.substring(0,11)}),"on:"," ",e("span",{className:"comment-film-name",children:a.film.name}),e("br",{}),"by:"," ",e("span",{className:"comment-author",children:a.author.name})]})]},a._id))})]})}const ae=()=>{const[t,n]=d.exports.useState([]);return d.exports.useEffect(async()=>{try{const{data:a}=await u.get("/api/films/lastReleased");console.log("data for films ? ",a),n(a)}catch(a){console.error(a)}},[]),t?s("section",{className:"LastReleased",children:[e("h2",{children:"Last released films:"}),e("div",{className:"last-released-box",children:t.map(a=>e(N,{to:`/films/${a._id}`,children:s("div",{className:"film",children:[e("div",{className:"image-film",children:e("img",{src:a.picture,alt:"travel image",className:"image"})}),s("div",{className:"film-infos",children:[console.log(a.releaseDate.substring(0,7)),s("span",{className:"film-release",children:["released on : ",a.releaseDate.substring(0,7)]})]})]},a._id)}))})]}):e("p",{children:"Loading..."})},ne=()=>s("div",{children:[e("h1",{children:"Welcome to Allo-Films!"}),s("div",{id:"Home",className:"Home",children:[e(ee,{}),e(ae,{}),e(te,{})]})]}),T=t=>{const[n,a]=d.exports.useState(t);return[n,r=>{a(w(C({},n),{[r.target.name]:r.target.value}))}]},se=()=>{const[{email:t,password:n},a]=T({email:"",password:""}),[i,r]=d.exports.useState(null),l=I(),{storeToken:c,authenticateUser:m}=S(),o=g=>{g.preventDefault(),u.signin({email:t,password:n}).then(p=>{console.log(p),c(p.authToken),m(),l("/")}).catch(p=>{r(p.response.data)})};return s(L,{children:[i&&e("h3",{className:"error",children:i.message}),s("form",{className:"formSignInSignUp",onSubmit:o,children:[e("h2",{children:"Signin"}),e("label",{htmlFor:"email",children:"Email"}),e("input",{type:"email",id:"email",name:"email",onChange:a,value:t}),e("label",{htmlFor:"password",children:"Password"}),e("input",{type:"password",id:"password",name:"password",onChange:a,value:n}),e("button",{children:"Submit"})]})]})},re=()=>e(se,{}),le=()=>{const[t,n]=T({name:"",email:"",password:""}),[a,i]=d.exports.useState(null),r=I(),l=c=>{c.preventDefault(),u.signup(t).then(()=>{r("/signin")}).catch(m=>{i(m.response.data)})};return s(L,{children:[a&&e("h3",{className:"error",children:a.message}),s("form",{className:"formSignInSignUp",onSubmit:l,children:[e("h2",{children:"Signup"}),e("label",{htmlFor:"name",children:"Name"}),e("input",{onChange:n,value:t.name,type:"text",id:"name",name:"name"}),e("label",{htmlFor:"email",children:"Email"}),e("input",{onChange:n,value:t.email,type:"email",id:"email",name:"email"}),e("label",{htmlFor:"password",children:"Password"}),e("input",{onChange:n,value:t.password,type:"password",id:"password",name:"password"}),e("button",{children:"Submit"})]})]})},oe=()=>e(le,{}),ie=()=>{const{currentUser:t,authenticateUser:n,storeToken:a}=S(),[i,r]=d.exports.useState(t==null?void 0:t.avatar),[l,c]=d.exports.useState(t==null?void 0:t.name),[m,o]=d.exports.useState(!1),g=async p=>{p.preventDefault();const h=new FormData;h.append("name",l),h.append("avatar",i);try{const v=(await u.patch(`/api/auth/profile/update/${t._id}`,h)).data.authToken;a(v),n(),o(!1)}catch(f){console.log(f)}};return s("div",{className:"Profile",children:[s("h2",{children:["Welcome to your profile : ",t.name," !"]}),e("img",{src:`${t.avatar}`,alt:t.name}),e("button",{onClick:()=>{o(!m)},children:"Update your profile"}),m&&s("form",{onSubmit:g,children:[e("label",{htmlFor:t.name,children:"Change your name :"}),e("input",{type:"text",name:"name",value:l,onChange:p=>c(p.target.value)}),e("label",{htmlFor:t.avatar,children:"Change your picture :"}),e("input",{type:"file",name:"avatar",onChange:p=>r(p.target.files[0])}),e("button",{children:"Submit"})]})]})},ce=({searchCallback:t})=>s("form",{id:"searchbar",className:"searchbar",children:[e("label",{htmlFor:"search"}),e("input",{type:"text",placeholder:"Search a movie",name:"search",textalign:"left",onChange:n=>t(n.target.value)})]}),de=()=>{const[t,n]=d.exports.useState([]),a=d.exports.useRef(0),i=d.exports.useRef(!1),[r,l]=d.exports.useState("");d.exports.useEffect(()=>{u.get("/api/films",{params:{q:r,offset:0}}).then(o=>n(o.data)).catch(o=>console.error(o))},[r]);const c=()=>{console.log("films.length",t.length),!(i.current||!t.length)&&(i.current=!0,a.current+=15,u.get("/api/films",{params:{q:r,offset:a.current}}).then(o=>{n(o.data),i.current=!1}).catch(o=>{console.error(o),i.current=!1}))},m=()=>{i.current||a.current<1||(i.current=!0,a.current-=15,u.get("/api/films",{params:{q:r,offset:a.current}}).then(o=>{n(o.data),i.current=!1}).catch(o=>{console.error(o),i.current=!1}))};return console.log("q:",r),console.log(t),s("section",{id:"List",className:"List",children:[e("h1",{children:"Our list of films"}),e(ce,{searchCallback:l}),s("div",{className:"pagination",children:[e("button",{onClick:m,children:"prev"}),"Page number: ",a.current/15+1,e("button",{onClick:c,children:"next"})]}),t.map((o,g)=>e(N,{id:"filmCard",className:"filmCard",to:`/films/${o._id}`,children:s("div",{children:[e("img",{src:o.picture,alt:o.name,width:"100px"}),e("h3",{children:o.name})," "]})},g)),s("div",{className:"pagination",children:[e("button",{onClick:m,children:"prev"}),"Page number: ",a.current/15+1,e("button",{onClick:c,children:"next"})]})]})},me=({comments:t,setComments:n})=>{const{isLoggedIn:a,currentUser:i}=S(),[r,l]=d.exports.useState(""),[c,m]=d.exports.useState({id:null,show:!1}),{id:o}=F(),g=(h,f)=>{u.patch(`/api/films/${o}/comments/${h}`,{content:r}).then(()=>{const v=[...t];v[f].content=r,n(v),m({id:null,show:!c.show})}).catch(v=>console.log(v))},p=h=>{u.delete(`/api/films/${o}/comments/${h}`).then(()=>{console.log("dans le then"),n(f=>f.filter(v=>v._id!==h)),m({id:null,show:!c.show})}).catch(f=>console.log(f))};return s(L,{children:[e("h2",{children:" Comments on this film"}),e("ul",{children:t.map((h,f)=>s("li",{children:[e("span",{children:e("strong",{children:h.author.name})})," :",e("span",{children:h.content}),a&&i.name===h.author.name&&e("button",{className:"buttonStyle",onClick:()=>m({id:h._id,show:!c.show}),children:e("i",{class:"fa-solid fa-pen-to-square"})}),c.id===h._id&&c.show&&a&&i&&s(L,{children:[e("textarea",{name:"",id:"",cols:"30",rows:"10",defaultValue:h.content,onChange:v=>{l(v.target.value)}}),e("button",{className:"buttonStyle",onClick:()=>g(h._id,f),children:"Save edit"})]}),a&&i.name===h.author.name&&e("button",{className:"buttonStyle",onClick:()=>p(h._id),children:e("i",{class:"fa-solid fa-eraser"})})]},h._id))})]})},he=()=>{const[t,n]=d.exports.useState({}),{id:a}=F(),[i,r]=d.exports.useState([]);return d.exports.useEffect(()=>{u.get(`/api/films/${a}`).then(l=>{n(l.data)})},[t._id]),d.exports.useEffect(()=>{u.get(`/api/films/${a}/comments`).then(l=>r(l.data)).catch(l=>console.log(l))},[]),t.name?s("div",{className:"film-details",children:[s("div",{className:"details-date",children:[s("h1",{children:[" Film : ",t.name]}),e("br",{}),s("h2",{children:["Release date : ",t.releaseDate]})]}),e("div",{className:"details-description",children:e("p",{children:t.description})}),s("div",{className:"group-detail",children:[e("div",{className:"details-picture",children:e("img",{src:t.picture,alt:t.name,width:"250px"})}),e("div",{className:"trailer",children:e("iframe",{width:"560",height:"315",src:`https://www.youtube.com/embed/${t.videos[0].key}`,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})]}),s("div",{className:"group-info",children:[s("div",{className:"casting",children:[e("h2",{children:"Casting:"}),e("ul",{className:"detail-ul",children:t.cast.map((l,c)=>e("li",{className:"details-element",children:l.name},c))})]}),s("div",{className:"genre",children:[e("h2",{children:"Genres:"}),e("ul",{className:"detail-ul",children:t.genre.map((l,c)=>e("li",{className:"details-element",children:l.name},c))})]}),s("div",{className:"crew",children:[e("h2",{children:"Crew:"}),e("ul",{className:"detail-ul",children:t.crew.map((l,c)=>s("li",{className:"details-element",children:[e("strong",{children:l.job})," : ",l.name]},c))})]})]}),e(Z,{setComments:r}),e("div",{className:"details-comment",children:e(me,{comments:i,setComments:r})})]}):e("p",{children:"Loading..."})},ue=()=>{const{isLoggedIn:t,isLoading:n}=S();return n?e("p",{children:"Loading..."}):t?e(V,{}):e(M,{to:"/signin"})};function ge(){return s("div",{className:"App",children:[e(J,{}),s(z,{children:[e(b,{path:"/",element:e(ne,{})}),e(b,{path:"/films",element:e(de,{})}),e(b,{path:"/films/:id",element:e(he,{})}),e(b,{path:"/signin",element:e(re,{})}),e(b,{path:"/signup",element:e(oe,{})}),e(b,{element:e(ue,{}),children:e(b,{path:"/profile",element:e(ie,{})})})]}),e(X,{})]})}const pe=({children:t})=>{const[n,a]=d.exports.useState({currentUser:null,isLoading:!0,isLoggedIn:!1});d.exports.useEffect(()=>{i()},[]);const i=()=>{const o=localStorage.getItem("authToken");o?u.isLoggedIn(o).then(g=>{a({currentUser:g,isLoading:!1,isLoggedIn:!0})}).catch(g=>{a({currentUser:null,isLoading:!1,isLoggedIn:!1})}):a({currentUser:null,isLoading:!1,isLoggedIn:!1})},r=()=>{l(),i()},l=()=>{localStorage.removeItem("authToken")},c=o=>{localStorage.setItem("authToken",o)},m={currentUser:n.currentUser,isLoading:n.isLoading,isLoggedIn:n.isLoggedIn,removeUser:r,storeToken:c,authenticateUser:i};return e(E.Provider,{value:m,children:t})};Q.render(e(W.StrictMode,{children:e(G,{children:e(pe,{children:e(ge,{})})})}),document.getElementById("root"));
